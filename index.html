import * as BABYLON from "@babylonjs/core";
import "@babylonjs/loaders";
import { ArcRotateCamera, HemisphericLight, MeshBuilder, Vector3, Color3, StandardMaterial } from "@babylonjs/core";

const canvas = document.getElementById("renderCanvas");
const engine = new BABYLON.Engine(canvas, true);
const scene = new BABYLON.Scene(engine);

// Camera
const camera = new ArcRotateCamera("camera", Math.PI / 2, Math.PI / 3, 60, new Vector3(0, 0, 0), scene);
camera.attachControl(canvas, true);

// Ánh sáng
const light = new HemisphericLight("light", new Vector3(0, 1, 0), scene);

// Vật liệu
const roadMat = new StandardMaterial("roadMat", scene);
roadMat.diffuseColor = new Color3(0.1, 0.1, 0.1);

const sidewalkMat = new StandardMaterial("sidewalkMat", scene);
sidewalkMat.diffuseColor = new Color3(0.6, 0.6, 0.6);

const buildingMat = new StandardMaterial("buildingMat", scene);
buildingMat.diffuseColor = new Color3(0.7, 0.2, 0.2);

// Tạo 3 con đường song song
const roadWidth = 4;
const roadLength = 100;
const spacing = 8; // Khoảng cách giữa các đường

for (let i = 0; i < 3; i++) {
  const x = (i - 1) * spacing;

  const road = MeshBuilder.CreateBox("road" + i, {
    width: roadWidth,
    height: 0.1,
    depth: roadLength,
  }, scene);
  road.position.x = x;
  road.material = roadMat;

  // Vỉa hè hai bên
  for (let side = -1; side <= 1; side += 2) {
    const sidewalk = MeshBuilder.CreateBox("sidewalk" + i + "_" + side, {
      width: 1.5,
      height: 0.1,
      depth: roadLength,
    }, scene);
    sidewalk.position.x = x + side * (roadWidth / 2 + 0.75);
    sidewalk.position.y = 0.05;
    sidewalk.material = sidewalkMat;

    // Cây/cột đèn đơn giản
    for (let z = -45; z <= 45; z += 15) {
      const tree = MeshBuilder.CreateCylinder("tree" + i + "_" + z, {
        diameter: 0.5,
        height: 3,
      }, scene);
      tree.position.x = sidewalk.position.x;
      tree.position.y = 1.5;
      tree.position.z = z;
    }
  }
}

// Chạy render loop
engine.runRenderLoop(() => {
  scene.render();
});

window.addEventListener("resize", function () {
  engine.resize();
});
